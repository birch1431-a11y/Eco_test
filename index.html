<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>상황판 복구모드</title>
    <style>
        body { background:#121212; color:white; font-family:sans-serif; padding:20px; }
        .item-row { display:flex; justify-content:space-between; padding:10px; border-bottom:1px solid #333; }
        .up { color:#ff4444; } .down { color:#4488ff; }
        .status-danger { color:#ff4444 !important; font-weight:bold; }
        .status-warning { color:#ffbb33 !important; font-weight:bold; }
        .status-safe { color:#00ff88 !important; }
    </style>
</head>
<body>
    <h2>글로벌 지표 (복구모드)</h2>
    <div id="display-area">
        <div class="item-row"><span>S&P 500</span><span id="SP500">--</span></div>
        <div class="item-row"><span>VIX 지수</span><span id="VIX">--</span></div>
        <div class="item-row"><span>원/달러</span><span id="USD/KRW">--</span></div>
        <div class="item-row"><span>구리</span><span id="COPPER">--</span></div>
        <div class="item-row"><span>WTI유</span><span id="WTI">--</span></div>
    </div>

    <script>
        async function fetchData(ticker, id) {
            const url = `https://query1.finance.yahoo.com/v8/finance/chart/${ticker}?interval=1m&range=1d`;
            try {
                const res = await fetch(`https://corsproxy.io/?${encodeURIComponent(url)}`);
                const data = await res.json();
                const cur = data.chart.result[0].meta.regularMarketPrice;
                const el = document.getElementById(id);
                
                if(el) {
                    el.innerText = cur.toFixed(2);
                    // VIX 색상 적용
                    if (id === "VIX") {
                        if (cur >= 30) el.className = "status-danger";
                        else if (cur >= 20) el.className = "status-warning";
                        else el.className = "status-safe";
                    }
                }
            } catch(e) { console.log(id + " 실패"); }
        }

        // 우선 5개만 테스트
        fetchData("^GSPC", "SP500");
        fetchData("^VIX", "VIX");
        fetchData("HG=F", "COPPER");
        fetchData("CL=F", "WTI");
        
        // 환율은 별도 API 사용 (전체 코드의 로직과 동일)
        fetch(`https://api.twelvedata.com/quote?symbol=USD/KRW&apikey=7142915ec1dc45caad56dfc9fcf07341`)
        .then(r=>r.json()).then(d=> { if(d.close) document.getElementById("USD/KRW").innerText = parseFloat(d.close).toFixed(2); });
    </script>
</body>
</html>
