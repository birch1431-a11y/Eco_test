<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Econ Dash Final Pro</title>
    <style>
        body { background-color: #121212; color: #e0e0e0; font-family: -apple-system, sans-serif; padding: 15px; margin: 0; }
        .header { text-align: center; font-size: 1.1rem; font-weight: bold; margin-bottom: 25px; color: #00ff88; cursor: pointer; padding: 10px; border: 1px solid #333; border-radius: 8px; }
        .category { margin-top: 25px; font-size: 0.85rem; color: #888; font-weight: bold; }
        .hr-short { border: 0; border-top: 2px solid #00ff88; width: 30px; margin: 5px 0 10px 0; }
        .item-row { display: flex; justify-content: space-between; align-items: center; padding: 10px 5px; border-bottom: 1px solid #222; }
        .label { font-size: 0.95rem; color: #bbb; }
        .unit-text { font-size: 0.75rem; color: #666; margin-left: 4px; }
        .val-container { text-align: right; }
        .value { font-size: 1rem; font-weight: 600; font-family: 'Roboto Mono', monospace; color: #ffffff; display: block; }
        .change { font-size: 0.75rem; font-weight: 400; margin-top: 2px; }
        .up { color: #ff4444; }
        .down { color: #4488ff; }
        .status-danger { color: #ff4444 !important; }
        .status-warning { color: #ffbb33 !important; }
        .status-safe { color: #00ff88 !important; }
    </style>
</head>
<body>

    <div class="header" onclick="resetKey()">ğŸ”„ ECON DASHBOARD V5.9</div>

    <div class="category">ì™¸í™˜ (Forex)</div><hr class="hr-short">
    <div class="item-row"><span class="label">ë‹¬ëŸ¬ì§€ìˆ˜</span><div class="val-container"><span class="value" id="DXY">--</span><div class="change" id="DXY-c">--</div></div></div>
    <div class="item-row"><span class="label">ì›/ë‹¬ëŸ¬</span><div class="val-container"><span class="value" id="USD/KRW">--</span><div class="change" id="USD/KRW-c">--</div></div></div>
    <div class="item-row"><span class="label">ì›/ì—”</span><div class="val-container"><span class="value" id="JPY/KRW">--</span><div class="change" id="JPY/KRW-c">--</div></div></div>
    <div class="item-row"><span class="label">ì›/ìœ ë¡œ</span><div class="val-container"><span class="value" id="EUR/KRW">--</span><div class="change" id="EUR/KRW-c">--</div></div></div>
    <div class="item-row"><span class="label">ì›/ìœ„ì•ˆ</span><div class="val-container"><span class="value" id="CNY/KRW">--</span><div class="change" id="CNY/KRW-c">--</div></div></div>

    <div class="category">ì£¼ìš” ì¦ì‹œ (Index)</div><hr class="hr-short">
    <div class="item-row"><span class="label">ë¯¸ ì¦ì‹œ ì‹œì´<span class="unit-text">($T)</span></span><div class="val-container"><span class="value" id="US_MCAP">--</span><div class="change" id="US_MCAP-c">--</div></div></div>
    <div class="item-row"><span class="label">S&P 500</span><div class="val-container"><span class="value" id="SP500">--</span><div class="change" id="SP500-c">--</div></div></div>
    <div class="item-row"><span class="label">NASDAQ</span><div class="val-container"><span class="value" id="NASDAQ">--</span><div class="change" id="NASDAQ-c">--</div></div></div>
    <div class="item-row"><span class="label">ë‹¤ìš°ì¡´ìŠ¤</span><div class="val-container"><span class="value" id="DOW">--</span><div class="change" id="DOW-c">--</div></div></div>
    <div class="item-row"><span class="label">í•œ ì¦ì‹œ ì‹œì´<span class="unit-text">(ì¡°â‚©)</span></span><div class="val-container"><span class="value" id="KR_MCAP">--</span><div class="change" id="KR_MCAP-c">--</div></div></div>
    <div class="item-row"><span class="label">KOSPI</span><div class="val-container"><span class="value" id="KOSPI">--</span><div class="change" id="KOSPI-c">--</div></div></div>
    <div class="item-row"><span class="label">KOSDAQ</span><div class="val-container"><span class="value" id="KOSDAQ">--</span><div class="change" id="KOSDAQ-c">--</div></div></div>

    <div class="category">ë¯¸êµ­ êµ­ì±„ ê¸ˆë¦¬</div><hr class="hr-short">
    <div class="item-row"><span class="label">30Y Yield</span><div class="val-container"><span class="value" id="US30Y">--</span><div class="change" id="US30Y-c">--</div></div></div>
    <div class="item-row"><span class="label">10Y Yield</span><div class="val-container"><span class="value" id="US10Y">--</span><div class="change" id="US10Y-c">--</div></div></div>
    <div class="item-row"><span class="label">2Y Yield</span><div class="val-container"><span class="value" id="US2Y">--</span><div class="change" id="US2Y-c">--</div></div></div>

    <div class="category">Commodities (ì›ìì¬)</div><hr class="hr-short">
    <div class="item-row"><span class="label">GOLD<span class="unit-text">($/oz)</span></span><div class="val-container"><span class="value" id="GOLD">--</span><div class="change" id="GOLD-c">--</div></div></div>
    <div class="item-row"><span class="label">SILVER<span class="unit-text">($/oz)</span></span><div class="val-container"><span class="value" id="SILVER">--</span><div class="change" id="SILVER-c">--</div></div></div>
    <div class="item-row"><span class="label">PLATINUM<span class="unit-text">($/oz)</span></span><div class="val-container"><span class="value" id="PLATINUM">--</span><div class="change" id="PLATINUM-c">--</div></div></div>

    <div class="category">Crypto (ê°€ìƒìì‚°)</div><hr class="hr-short">
    <div class="item-row"><span class="label">BTC<span class="unit-text">($)</span></span><div class="val-container"><span class="value" id="BTC">--</span><div class="change" id="BTC-c">--</div></div></div>
    <div class="item-row"><span class="label">ETH<span class="unit-text">($)</span></span><div class="val-container"><span class="value" id="ETH">--</span><div class="change" id="ETH-c">--</div></div></div>
    <div class="item-row"><span class="label">XRP<span class="unit-text">($)</span></span><div class="val-container"><span class="value" id="XRP">--</span><div class="change" id="XRP-c">--</div></div></div>

    <div class="category">ì‹œì¥ ì‹¬ë¦¬ ë° ë°¸ë¥˜ì—ì´ì…˜</div><hr class="hr-short">
    <div class="item-row"><span class="label">VIX ì§€ìˆ˜<span class="unit-text">(ê³µí¬ì§€ìˆ˜)</span></span><div class="val-container"><span class="value" id="VIX">--</span><div class="change" id="VIX-c">--</div></div></div>
    <div class="item-row"><span class="label">ì¥ë‹¨ê¸° ê¸ˆë¦¬ì°¨<span class="unit-text">(10Y-2Y)</span></span><div class="val-container"><span class="value" id="SPREAD">--</span><div class="change" id="SPREAD-c">--</div></div></div>
    <div class="item-row"><span class="label">ë²„í• ì§€ìˆ˜<span class="unit-text">(ì‹¤ì‹œê°„ ì—°ë™)</span></span><span class="value" id="BUFFETT">--</span></div>
    <div class="item-row"><span class="label">ì‰´ëŸ¬ PER<span class="unit-text">(CAPE)</span></span><span class="value" id="SHILLER">--</span></div>

    <div id="status-msg" style="text-align:center; font-size:0.7rem; color:#555; margin-top:30px;">ë°ì´í„° ë¡œë”© ì¤‘...</div>

    <script>
        const BASE_US_GDP = 27.94; 
        const BASE_US_MCAP = 55.2; 
        const BASE_KR_MCAP = 2450; 

        async function fetchData(url) {
            const proxies = [`https://api.allorigins.win/get?url=${encodeURIComponent(url)}`, `https://corsproxy.io/?${encodeURIComponent(url)}` ];
            for (let proxy of proxies) {
                try {
                    const res = await fetch(proxy);
                    const json = await res.json();
                    const data = json.contents ? JSON.parse(json.contents) : json;
                    if (data) return data;
                } catch (e) { continue; }
            }
            return null;
        }

        let globalRates = { "10Y": 0, "2Y": 0, "10Y_prev": 0, "2Y_prev": 0 };

        function formatChange(current, prev, id) {
            if (!prev || !current) return "0.00";
            const diff = current - prev;
            const percent = (diff / prev * 100).toFixed(2);
            const sign = diff > 0 ? "â–²" : diff < 0 ? "â–¼" : "";
            const cls = diff > 0 ? "up" : diff < 0 ? "down" : "";
            const changeEl = document.getElementById(id + "-c");
            if(changeEl) {
                changeEl.innerHTML = `<span class="${cls}">${sign} ${Math.abs(diff).toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})} (${percent}%)</span>`;
            }
            return percent;
        }

        async function getYahoo(ticker, id) {
            const el = document.getElementById(id);
            const url = `https://query1.finance.yahoo.com/v8/finance/chart/${ticker}?interval=1m&range=1d`;
            try {
                const data = await fetchData(url);
                if (data && data.chart && data.chart.result) {
                    const meta = data.chart.result[0].meta;
                    const price = meta.regularMarketPrice;
                    const prev = meta.previousClose;

                    if (id === "US10Y") { globalRates["10Y"] = price; globalRates["10Y_prev"] = prev; }
                    if (id === "US2Y") { globalRates["2Y"] = price; globalRates["2Y_prev"] = prev; }

                    if (el) {
                        if (ticker === "^IXIC" || ticker === "^DJI") {
                            el.innerText = price.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
                        } 
                        else if (id.includes("US") && !id.includes("MCAP")) {
                            el.innerText = price.toFixed(3) + "%";
                        }
                        else if (price > 100) {
                            el.innerText = price.toLocaleString(undefined, {maximumFractionDigits: 2});
                        }
                        else {
                            el.innerText = price.toFixed(2);
                        }
                        formatChange(price, prev, id);
                    }

                    if (ticker === "VTI") {
                        const ratio = price / prev;
                        const curMcap = BASE_US_MCAP * ratio;
                        const mcapEl = document.getElementById("US_MCAP");
                        if (mcapEl) {
                            mcapEl.innerText = curMcap.toFixed(2);
                            formatChange(curMcap, BASE_US_MCAP, "US_MCAP");
                        }
                        
                        const liveBuffett = parseFloat((curMcap / BASE_US_GDP * 100).toFixed(1));
                        const bEl = document.getElementById("BUFFETT");
                        if (bEl) {
                            bEl.innerText = liveBuffett + "%";
                            if (liveBuffett >= 150) bEl.className = "value status-danger";
                            else if (liveBuffett >= 120) bEl.className = "value status-warning";
                            else bEl.className = "value status-safe";
                        }
                    }

                    if (id === "KOSPI") {
                        const curKrMcap = (BASE_KR_MCAP * (price / prev));
                        const krMcapEl = document.getElementById("KR_MCAP");
                        if (krMcapEl) {
                            krMcapEl.innerText = Math.floor(curKrMcap).toLocaleString();
                            formatChange(curKrMcap, BASE_KR_MCAP, "KR_MCAP");
                        }
                    }

                    if (id === "VIX" && el) {
                        if (price >= 30) el.className = "value status-danger";
                        else if (price >= 20) el.className = "value status-warning";
                        else el.className = "value status-safe";
                    }
                }
            } catch (e) { if(el) el.innerText = "N/A"; }
        }

        async function loadData() {
            const startTime = Date.now();
            const yahooItems = [
                ["VTI", "VTI_INTERNAL"], ["DX-Y.NYB", "DXY"], ["^GSPC", "SP500"], ["^IXIC", "NASDAQ"], ["^DJI", "DOW"],
                ["^KS11", "KOSPI"], ["^KQ11", "KOSDAQ"], ["^TYX", "US30Y"], ["^TNX", "US10Y"],
                ["^IRX", "US2Y"], ["GC=F", "GOLD"], ["SI=F", "SILVER"], ["PL=F", "PLATINUM"],
                ["BTC-USD", "BTC"], ["ETH-USD", "ETH"], ["XRP-USD", "XRP"], ["^VIX", "VIX"]
            ];

            const yahooPromises = yahooItems.map(item => getYahoo(item[0], item[1]));

            let key = localStorage.getItem('ECON_KEY_V5');
            if (!key) {
                key = prompt("Twelve Data API í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
                if(key) localStorage.setItem('ECON_KEY_V5', key.trim());
                else return;
            }

            // --- ìˆ˜ì •ëœ ì™¸í™˜ ì¼ê´„ í˜¸ì¶œ ë¡œì§ ---
            const fxSymbols = "USD/KRW,JPY/KRW,EUR/KRW,CNY/KRW";
            const fxPromise = (async () => {
                try {
                    const r = await fetch(`https://api.twelvedata.com/quote?symbol=${fxSymbols}&apikey=${key}`);
                    const d = await r.json();
                    
                    const symbols = fxSymbols.split(',');
                    symbols.forEach(s => {
                        const data = d[s];
                        const el = document.getElementById(s);
                        if (data && data.close && el) {
                            const cur = parseFloat(data.close);
                            const pre = parseFloat(data.previous_close);
                            if (s === "USD/KRW" || s === "EUR/KRW" || s === "CNY/KRW") {
                                el.innerText = cur.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
                            } else {
                                el.innerText = cur.toLocaleString(undefined, {minimumFractionDigits: 2});
                            }
                            formatChange(cur, pre, s);
                        } else if (el) {
                            el.innerText = "N/A";
                        }
                    });
                } catch(e) { 
                    fxSymbols.split(',').forEach(s => {
                        const el = document.getElementById(s);
                        if(el) el.innerText = "N/A";
                    });
                }
            })();
            // -------------------------------

            await Promise.all([...yahooPromises, fxPromise]);

            const spread = globalRates["10Y"] - globalRates["2Y"];
            const prevSpread = globalRates["10Y_prev"] - globalRates["2Y_prev"];
            const spreadEl = document.getElementById("SPREAD");
            if (spreadEl) {
                spreadEl.innerText = spread.toFixed(3) + "%p";
                formatChange(spread, prevSpread, "SPREAD");
                if (spread < 0) spreadEl.className = "value status-danger";
            }

            const shillerVal = 35.2;
            const sEl = document.getElementById("SHILLER");
            if (sEl) {
                sEl.innerText = shillerVal.toFixed(1);
                if (shillerVal >= 30) sEl.className = "value status-danger";
                else if (shillerVal >= 20) sEl.className = "value status-warning";
                else sEl.className = "value status-safe";
            }

            document.getElementById('status-msg').innerText = `Update: ${new Date().toLocaleTimeString()} (${((Date.now() - startTime) / 1000).toFixed(1)}s)`;
        }

        function resetKey() { localStorage.removeItem('ECON_KEY_V5'); location.reload(); }
        window.onload = loadData;
    </script>
</body>
</html>
